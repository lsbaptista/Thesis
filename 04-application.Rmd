# Aplicação a dados do modelo
\endgroup
\newpage

## Introdução
```{r,include=FALSE}
rm(list = ls())
knitr::opts_chunk$set(tidy=FALSE, message = FALSE,warning =  FALSE,fig.align = "center",fig.show = "hold")
#install.packages("xlsx")
#install.packages("kableExtra")
#install.packages("quantmod")
#install.packages("MASS")
#install.packages("arsenal")
#install.packages("formatR")
#install.packages("tidyquant")
#install.packages("rugarch")
#install.packages("ggfortify")
library(ggfortify)
library(tidyquant)
library(rugarch)
library(arsenal)
library(MASS)
library(kableExtra)
library(xlsx)
library(tidyverse)
```

## Análise descritiva dos dados
A primeira fase consiste em extrair de forma aleatória 4 acções constituintes do Euro Stoxx 50, estando os valores obtidos representados na figura \@ref(fig:empresas).

```{r, empresas,echo=FALSE,fig.cap='Empresas extraidas do Euro Stoxx 50',out.width="100%"}
knitr::include_graphics("image/cotacao.png")
```
\FloatBarrier
\centering 
Fonte: Elaboração própria.

\justifying
\bigskip
\scriptsize
```{r}
#leitura de simbolos dos activos financeiros
symbolsEU <- c("TEF.MC","UNA.AS",'GLE.PA',"AIR.PA")
getSymbols(symbolsEU,src = "yahoo", from="2016-06-01", to="2020-06-02")
```
\normalsize

```{r,echo=FALSE}
gle<-tail(GLE.PA)
gle <- knitr::kable(
gle, caption = "Société Générale.Euronext Paris-25-05-2020/01-06-2020",
booktabs = TRUE)
kable_styling(gle, latex_options = c("hold_position","scale_down"), position = "center")
```
\FloatBarrier
\centering 
Fonte:https://finance.yahoo.com/

\justifying
\bigskip

```{r,cotacao,echo=FALSE, fig.cap='Evolução das cotações nos últimos 5 anos',fig.topcaption = TRUE,out.width = "45%"}
par(mfrow  = c(2,2))
  chartSeries(TEF.MC,theme = chartTheme("white"))
  chartSeries(UNA.AS,theme = chartTheme("white"))
  chartSeries(GLE.PA,theme = chartTheme("white"))
  chartSeries(AIR.PA,theme = chartTheme("white"))
```
\FloatBarrier
\centering 
Fonte: Elaboração própria.

\justifying
\bigskip

```{r,echo=FALSE}
newdata <- merge(TEF.MC$TEF.MC.Adjusted,UNA.AS$UNA.AS.Adjusted,GLE.PA$GLE.PA.Adjusted,AIR.PA$AIR.PA.Adjusted)
newdata <- na.omit(newdata)
adj <- tail(newdata)
adj <- knitr::kable(
adj, caption = "Cotações a preços ajustados-25-05-2020/01-06-2020",
booktabs = TRUE)
kable_styling(adj, latex_options = "hold_position", position = "center")
```
\FloatBarrier
\centering 
Fonte:https://finance.yahoo.com/

\justifying
\bigskip

```{r, echo=FALSE}
pt <-summary(as.data.frame(newdata))
p <- knitr::kable(
pt, caption = "Estatísticas das cotações",
booktabs = TRUE)
kable_styling(p, latex_options = "hold_position", position = "center")
```
\FloatBarrier
\centering 
Fonte:Elaboração própria.

\justifying
\bigskip
```{r,echo=FALSE}
returns <- as.xts(data.frame(round(dailyReturn(newdata$TEF.MC.Adjusted,type="log"),4),round(dailyReturn(newdata$UNA.AS.Adjusted,type="log"),4),round(dailyReturn(newdata$GLE.PA.Adjusted,type="log"),4),round(dailyReturn(newdata$AIR.PA.Adjusted,type="log"),4)))
returns <- returns[-1,]
colnames(returns)<-c("TEF.RET","UNA.RET","GLE.RET","AIR.RET")
ret <- tail(returns)
retv <- knitr::kable(
ret, caption = "Retornos logarítmicos diários-25-05-2020/01-06-2020",
booktabs = TRUE)
kable_styling(retv, latex_options = "hold_position", position = "center")
```
\FloatBarrier
\centering 
Fonte:Elaboração própria.

\justifying
\bigskip
```{r, echo=FALSE}
retcor <- cor(returns)
retcork <- knitr::kable(
retcor, caption = "Matrix correlação dos retornos",
booktabs = TRUE)
kable_styling(retcork , latex_options = "hold_position", position = "center")
```
\FloatBarrier
\centering 
Fonte:Elaboração própria.

\justifying
\bigskip
```{r, echo=FALSE}
retannual <- function(x) {  
  Return.annualized(x,geometric = FALSE)}
retvol <- function(x) {  
  StdDev.annualized(x,geometric = FALSE)}

ETFStats <- do.call(data.frame, 
                    list("média anual"= round(apply(returns, 2,retannual),6),
                         "volatilidade anual"= round(apply(returns, 2, retvol),6),
                         mediana = round(apply(returns, 2, median),6),
                         min = round(apply(returns, 2, min),6),
                         max = round(apply(returns, 2, max),6)))
ETFStats<-t(ETFStats)
ETFStatsk<- knitr::kable(
ETFStats, caption = "Estatísticas dos retornos",
booktabs = TRUE)
kable_styling(ETFStatsk , latex_options = "hold_position", position = "center")
```
\FloatBarrier
\centering 
Fonte:Elaboração própria.

\justifying
\bigskip
```{r,volatilidade,echo=FALSE, fig.cap='Volatilidade nos últimos 4 anos',fig.topcaption = TRUE,out.width = "45%"}
par(mfrow  = c(2,2))
  autoplot(returns$TEF.RET,ts.colour = 'darkgreen') + ggtitle("TELEFÓNICA") + 
  ylab("Log return") + xlab("anos") + theme(plot.title = element_text(hjust = 0.5))
  autoplot(returns$UNA.RET,ts.colour = 'darkgreen') + ggtitle("UNILEVER") + 
  ylab("Log return") + xlab("anos") + theme(plot.title = element_text(hjust = 0.5))
  autoplot(returns$GLE.RET,ts.colour = 'darkgreen') + ggtitle("SOCIÉTÉ GÉNÉRALE") + 
  ylab("Log return") + xlab("anos") + theme(plot.title = element_text(hjust = 0.5))
  autoplot(returns$AIR.RET,ts.colour = 'darkgreen') + ggtitle("AIRBUS") + 
  ylab("Log return") + xlab("anos") + theme(plot.title = element_text(hjust = 0.5))
```
\FloatBarrier
\centering 
Fonte:Elaboração própria.

\justifying
\bigskip
```{r,teste,echo=FALSE, fig.cap='Teste a normalidade das distribuições',fig.topcaption = TRUE,out.width = "100%"}
par(mfrow  = c(2,2))
  qqnorm(returns$TEF.RET,main="TELEFÓNICA",pch=14)
  qqline(returns$TEF.RET)
  qqnorm(returns$UNA.RET,main="UNILEVER",pch=14)
  qqline(returns$UNA.RET)
  qqnorm(returns$GLE.RET,main="SOCIÉTÉ GÉNÉRALE",pch=14)
  qqline(returns$GLE.RET)
  qqnorm(returns$AIR.RET,main="AIRBUS",pch=14)
  qqline(returns$AIR.RET)
```
\FloatBarrier
\centering 
Fonte:Elaboração própria.

\justifying
\bigskip
```{r,echo=FALSE}
lshap<- lapply(as.data.frame(returns), shapiro.test)
lres <- sapply(lshap, "[", c("statistic","p.value"))
lresk<- knitr::kable(
lres, caption = "Teste normalidade Shapiro-Wilk",
booktabs = TRUE)
kable_styling(lresk , latex_options = c("hold_position","scale_down"), position = "center")
```
\FloatBarrier
\centering 
Fonte:Elaboração própria.

\justifying
\bigskip

## EWMA
















