# Aplicação a dados do modelo
\endgroup
\newpage

## Introdução
```{r,include=FALSE}
rm(list = ls())
knitr::opts_chunk$set(tidy=FALSE, message = FALSE,warning =  FALSE,fig.align = "center",fig.show = "hold")
#install.packages("xlsx")
#install.packages("kableExtra")
#install.packages("quantmod")
#install.packages("MASS")
#install.packages("arsenal")
#install.packages("formatR")
#install.packages("tidyquant")
#install.packages("rugarch")
#install.packages("ggfortify")
#install.packages("MFTSR", repos="http://R-Forge.R-project.org")
#install.packages("fGarch")
#install.packages("RQuantLib")
library(RQuantLib)
library(fGarch)
library(MFTSR)
library(ggfortify)
library(tidyquant)
library(rugarch)
library(arsenal)
library(MASS)
library(kableExtra)
library(xlsx)
library(tidyverse)
```

## Análise descritiva dos dados
A primeira fase consiste em extrair de forma aleatória 4 acções constituintes do Euro Stoxx 50, estando os valores obtidos representados na figura \@ref(fig:empresas).

```{r, empresas,echo=FALSE,fig.cap='Empresas extraidas do Euro Stoxx 50',out.width="100%"}
knitr::include_graphics("image/cotacao.png")
```
\FloatBarrier
\centering 
Fonte: Elaboração própria.

\justifying
\bigskip
\scriptsize
```{r}
#leitura de simbolos dos activos financeiros
symbolsEU <- c("TEF.MC","UNA.AS",'GLE.PA',"AIR.PA")
getSymbols(symbolsEU,src = "yahoo", from="2016-06-01", to="2020-06-02")
```
\normalsize

```{r,echo=FALSE}
gle<-tail(GLE.PA)
gle <- knitr::kable(
gle, caption = "Société Générale.Euronext Paris-25-05-2020/01-06-2020",
booktabs = TRUE)
kable_styling(gle, latex_options = c("hold_position","scale_down"), position = "center")
```
\FloatBarrier
\centering 
Fonte:https://finance.yahoo.com/

\justifying
\bigskip

```{r,cotacao,echo=FALSE, fig.cap='Evolução das cotações nos últimos 5 anos',fig.topcaption = TRUE,out.width = "45%"}
par(mfrow  = c(2,2))
  chartSeries(TEF.MC,theme = chartTheme("white"))
  chartSeries(UNA.AS,theme = chartTheme("white"))
  chartSeries(GLE.PA,theme = chartTheme("white"))
  chartSeries(AIR.PA,theme = chartTheme("white"))
```
\FloatBarrier
\centering 
Fonte: Elaboração própria.

\justifying
\bigskip

```{r,echo=FALSE}
newdata <- merge(TEF.MC$TEF.MC.Adjusted,UNA.AS$UNA.AS.Adjusted,GLE.PA$GLE.PA.Adjusted,AIR.PA$AIR.PA.Adjusted)
newdata <- na.omit(newdata)
adj <- tail(newdata)
adj <- knitr::kable(
adj, caption = "Cotações a preços ajustados-25-05-2020/01-06-2020",
booktabs = TRUE)
kable_styling(adj, latex_options = "hold_position", position = "center")
```
\FloatBarrier
\centering 
Fonte:https://finance.yahoo.com/

\justifying
\bigskip

```{r, echo=FALSE}
pt <-summary(as.data.frame(newdata))
p <- knitr::kable(
pt, caption = "Estatísticas das cotações",
booktabs = TRUE)
kable_styling(p, latex_options = "hold_position", position = "center")
```
\FloatBarrier
\centering 
Fonte:Elaboração própria.

\justifying
\bigskip
```{r,echo=FALSE}
returns <- as.xts(data.frame(round(dailyReturn(newdata$TEF.MC.Adjusted,type="log"),4),round(dailyReturn(newdata$UNA.AS.Adjusted,type="log"),4),round(dailyReturn(newdata$GLE.PA.Adjusted,type="log"),4),round(dailyReturn(newdata$AIR.PA.Adjusted,type="log"),4)))
returns <- returns[-1,]
#dim(returns)
colnames(returns)<-c("TEF.RET","UNA.RET","GLE.RET","AIR.RET")
ret <- tail(returns)
retv <- knitr::kable(
ret, caption = "Retornos logarítmicos diários-25-05-2020/01-06-2020",
booktabs = TRUE)
kable_styling(retv, latex_options = "hold_position", position = "center")
```
\FloatBarrier
\centering 
Fonte:Elaboração própria.

\justifying
\bigskip
```{r, echo=FALSE}
retcor <- cor(returns)
retcork <- knitr::kable(
retcor, caption = "Matrix correlação dos retornos",
booktabs = TRUE)
kable_styling(retcork , latex_options = "hold_position", position = "center")
```
\FloatBarrier
\centering 
Fonte:Elaboração própria.

\justifying
\bigskip
```{r, echo=FALSE}
retannual <- function(x) {  
  Return.annualized(x,geometric = FALSE)}
retvol <- function(x) {  
  StdDev.annualized(x,geometric = FALSE)}

ETFStats <- do.call(data.frame, 
                    list("média anual"= round(apply(returns, 2,retannual),6),
                         "volatilidade anual"= round(apply(returns, 2, retvol),6),
                         mediana = round(apply(returns, 2, median),6),
                         skewness = round(apply(returns, 2, skewness),6),
                         kurtosis = round(apply(returns, 2, kurtosis),6),
                         min = round(apply(returns, 2, min),6),
                         max = round(apply(returns, 2, max),6)))
ETFStats<-t(ETFStats)
ETFStatsk<- knitr::kable(
ETFStats, caption = "Estatísticas dos retornos",
booktabs = TRUE)
kable_styling(ETFStatsk , latex_options = "hold_position", position = "center")
```
\FloatBarrier
\centering 
Fonte:Elaboração própria.

\justifying
\bigskip
```{r,volatilidade,echo=FALSE, fig.cap='Volatilidade nos últimos 4 anos',fig.topcaption = TRUE,out.width = "45%"}
par(mfrow  = c(2,2))
  autoplot(returns$TEF.RET,ts.colour = 'darkgreen') + ggtitle("TELEFÓNICA") + 
  ylab("Log return") + xlab("anos") + theme(plot.title = element_text(hjust = 0.5))
  autoplot(returns$UNA.RET,ts.colour = 'darkgreen') + ggtitle("UNILEVER") + 
  ylab("Log return") + xlab("anos") + theme(plot.title = element_text(hjust = 0.5))
  autoplot(returns$GLE.RET,ts.colour = 'darkgreen') + ggtitle("SOCIÉTÉ GÉNÉRALE") + 
  ylab("Log return") + xlab("anos") + theme(plot.title = element_text(hjust = 0.5))
  autoplot(returns$AIR.RET,ts.colour = 'darkgreen') + ggtitle("AIRBUS") + 
  ylab("Log return") + xlab("anos") + theme(plot.title = element_text(hjust = 0.5))
```
\FloatBarrier
\centering 
Fonte:Elaboração própria.

\justifying
\bigskip
```{r,distr,echo=FALSE, fig.cap='Distribuição dos retornos',fig.topcaption = TRUE,out.width = "100%"}
par(mfrow  = c(2,2))
  hist(returns$TEF.RET,probability=T, main="TELEFÓNICA",xlab="",breaks=100)
  lines(density(returns$TEF.RET),col=2)
  curve(dnorm(x,0,0.01695272), from = -0.06,to=0.06, col='blue',add = TRUE)
  hist(returns$UNA.RET,probability=T, main="UNILEVER",xlab="",breaks=100)
  lines(density(returns$UNA.RET),col=2)
  curve(dnorm(x,0,0.01298968), from = -0.05,to=0.05, col='blue',add = TRUE)
  hist(returns$GLE.RET,probability=T, main="SOCIÉTÉ GÉNÉRALE",xlab="",breaks=100)
  lines(density(returns$GLE.RET),col=2)
  curve(dnorm(x,0,0.02557792), from = -0.1,to=0.1, col='blue',add = TRUE)
  hist(returns$AIR.RET,probability=T, main="AIRBUS",xlab="",breaks=100)
  lines(density(returns$AIR.RET),col=2)
  curve(dnorm(x,0,0.02397011), from = -0.1,to=0.1, col='blue',add = TRUE)
```
\FloatBarrier
\centering 
Fonte:Elaboração própria.

\justifying
\bigskip
```{r,teste,echo=FALSE, fig.cap='Teste a normalidade das distribuições',fig.topcaption = TRUE,out.width = "100%"}
par(mfrow  = c(2,2))
  qqnorm(returns$TEF.RET,main="TELEFÓNICA",pch=14)
  qqline(returns$TEF.RET)
  qqnorm(returns$UNA.RET,main="UNILEVER",pch=14)
  qqline(returns$UNA.RET)
  qqnorm(returns$GLE.RET,main="SOCIÉTÉ GÉNÉRALE",pch=14)
  qqline(returns$GLE.RET)
  qqnorm(returns$AIR.RET,main="AIRBUS",pch=14)
  qqline(returns$AIR.RET)
```
\FloatBarrier
\centering 
Fonte:Elaboração própria.

\justifying
\bigskip
```{r,echo=FALSE}
lshap<- lapply(as.data.frame(returns), shapiro.test)
lres <- sapply(lshap, "[", c("statistic","p.value"))
lresk<- knitr::kable(
lres, caption = "Teste normalidade Shapiro-Wilk",
booktabs = TRUE)
kable_styling(lresk , latex_options = c("hold_position","scale_down"), position = "center")
```
\FloatBarrier
\centering 
Fonte:Elaboração própria.

\justifying
\bigskip

## EWMA

```{r,echo=FALSE}
ewma <- function(x) {  
  x<-ewmaVol(x,lambda = 0.94)
  return(tail(x$sigma,1))
  }

pewma <- do.call(data.frame, 
                    list("ewma"= round(apply(returns, 2,ewma),6)))
        
pewma<-t(pewma)
pewmak<- knitr::kable(
pewma, caption = "EWMA",
booktabs = TRUE)
kable_styling(pewmak , latex_options = "hold_position", position = "center")
```
\FloatBarrier
\centering 
Fonte:Elaboração própria.

\justifying
\bigskip

## GARCH

```{r}

```

## Volatilidade implicita

```{r,echo=FALSE}
TEFImp <- EuropeanOptionImpliedVolatility(type="call", value = 0.27, underlying = 4.40, strike = 4.40,dividendYield = 0, riskFreeRate = -0.575, maturity = 0.31746, volatility = 0.1)
UNAImp <- EuropeanOptionImpliedVolatility(type="call", value = 2.38, underlying = 46.66, strike = 46,dividendYield = 0, riskFreeRate = -0.575, maturity = 0.31746, volatility = 0.1)
SOGImp <- EuropeanOptionImpliedVolatility(type="call", value = 1.62, underlying = 13.82, strike = 14,dividendYield = 0, riskFreeRate = -0.575, maturity = 0.31746, volatility = 0.1)
AIRImp <- EuropeanOptionImpliedVolatility(type="call", value = 6.91, underlying = 59.44, strike = 60,dividendYield = 0, riskFreeRate = -0.575, maturity = 0.31746, volatility = 0.1)

TEFImp <- round(TEFImp[]/sqrt(252),6)
UNAImp<-round(UNAImp[]/sqrt(252),6)
SOGImp<-round(SOGImp[]/sqrt(252),6)
AIRImp<-round(AIRImp[]/sqrt(252),6)

pimpvol<-cbind(TEFImp,UNAImp,SOGImp,AIRImp)
colnames(pimpvol)<-c("TEF.RET","UNA.RET","GLE.RET","AIR.RET")
rownames(pimpvol)<-"Volatilidade implícita"

pimpvolk<- knitr::kable(
pimpvol, caption = "Volatilidade Implícita",
booktabs = TRUE)
kable_styling(pimpvolk , latex_options = c("hold_position","scale_down"), position = "center")
```
\FloatBarrier
\centering 
Fonte:Elaboração própria.

\justifying
\bigskip




