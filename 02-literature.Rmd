\begingroup
\titleformat{\chapter}[display]
{\normalfont\huge\bfseries\centering}{\chaptertitlename\ \thechapter}{20pt}{\Huge}
# Modela√ß√£o Estat√≠stica na Otimiza√ß√£o de Portf√≥lios
\newpage

```{r, include=FALSE}
knitr::opts_chunk$set(tidy=FALSE, message = FALSE,warning =  FALSE,fig.align = "center",fig.show = "hold")
```

## Series Temporais

O valor da cota√ß√£o de activos financeiros, como ac√ß√µes ou op√ß√µes, s√£o representados de forma sequencial ao longo do tempo, considerando determinado intervalo, que pode ser segundos, minutos, dias, semanas ou outro intervalo considerado √∫til para representa√ß√£o dos dados ao longo do tempo. Quando tal acontece estamos em presen√ßa de series temporais.

Os pre√ßos de activos financeiros ao longo do tempo formam o que √© denominado por processos estoc√°sticos. Processos estoc√°sticos s√£o uma classe de series temporais onde o valor da vari√°vel muda ao longo de tempo de forma aleat√≥ria. Os processo estoc√°sticos podem ser classificados de discretos ou cont√≠nuos, sendo que na an√°lise de activos financeiros, embora estes sigam processos discretos, ser√£o considerados processos estoc√°sticos cont√≠nuos ao longo do tempo, sendo que estes modelos acabam por ser bastante √∫teis na modeliza√ß√£o dos pre√ßos de activos financeiros de acordo com @Hull2018.

### Modela√ß√£o do pre√ßo de ac√ß√µes

Os pre√ßos das ac√ß√µes seguem habitualmente o que √© conhecido por um processo de Markov, onde apenas o valor presente importa para prever o valor futuro. Desta forma a √∫nica informa√ß√£o relevante √© o seu valor no momento, sendo que os valores e trajecto verificado no passado n√£o ir√£o ter import√¢ncia na defini√ß√£o da distribui√ß√£o probabil√≠stica do pre√ßo no futuro [@Hull2018].Desta forma as propriedades de Markov no pre√ßo das ac√ß√µes √© consistente com a efici√™ncia dos mercados na forma fraca, constituindo esta uma das tr√™s formas de efici√™ncia de mercado definidas por Eugene Fama^[Ver "https://pt.wikipedia.org/wiki/Eugene_Fama"].

O modelo representado aqui e que ser√° utilizado para simular pre√ßos de activos financeiros atravessou v√°rios pressupostos at√© a sua conclus√£o final, sendo apresentado de uma forma muito sucinta as principais etapas de desenvolvimento desse modelo.

Um dos primeiros modelos era representado por um processo de Wiener, sendo este um processo particular do processo estoc√°stico Markov, referido como movimento Browniano, descrevendo a evolu√ß√£o de uma vari√°vel com distribui√ß√£o normal padr√£o. A modela√ß√£o pressup√µe que a vari√°vel z possa ser dada pela seguinte equa√ß√£o:

\begin{equation} 
  dz = \varepsilon \sqrt{dt}\qquad   \varepsilon \sim N(0,1);
  (\#eq:wiener)
\end{equation} 

Desta forma a vari√°vel z segue um processo de Wiener, sendo uma vari√°vel independente e identicamente distribu√≠da (i.i.d). 

Como este modelo n√£o preenchia todos os pressupostos, aplicou-se um processo generalizado de Wiener (tamb√©m conhecido como movimento Browniano (BM)), onde √© incluindo um amplificador/redutor na parte aleat√≥ria do processo de forma a ajustar o processo a propriedades especificas de cada ac√ß√£o, ilustrado na equa√ß√£o \@ref(eq:gwiener). Este processo descreve a evolu√ß√£o de um processo de uma vari√°vel com distribui√ß√£o normal, com um desvio $\mu$ por unidade de tempo e uma taxa de vari√¢ncia de $\sigma^2$ tamb√©m por unidade de tempo. 
 
\begin{equation} 
  \delta S = \mu\delta t +\sigma\varepsilon\sqrt{\delta t}\qquad\varepsilon \sim N(0,1);
  (\#eq:gwiener)
\end{equation} 

A diferen√ßa relativo a um processo de Wiener √© que no processo generalizado de Wiener a taxa de desvio e vari√¢ncia pode ter como valor qualquer constante, sendo que no processo de Wiener esses valores s√£o de 0 e 1 respectivamente.

Outro processo estoc√°stico, conhecido como processo It√¥, foi desenvolvido, representando um processo generalizado de Wiener, sendo que neste caso o valor dos par√¢metros $\mu$ e $\sigma$ s√£o fun√ß√µes do valor subjacente da vari√°vel S e do tempo t. Este modelo √© o que vai ser utilizado para simula√ß√£o do pre√ßo das ac√ß√µes sendo representado pelas seguintes equa√ß√µes:

\begin{equation} 
  \frac{\delta S}{S} = \mu\delta t +\sigma\varepsilon\sqrt{\delta t}\qquad\varepsilon \sim N(0,1);
  (\#eq:ito)
\end{equation} 
\begin{equation} 
  In S_1 - InS_0 \approx\phi\Big[\Big(\mu-\frac{\sigma^2}{2}\Big)\delta t, \sigma\sqrt{\delta t}\Big]
  (\#eq:Inito)
\end{equation} 
\begin{equation} 
  S_1 =S_0 e^{\Big(\mu-\frac{\sigma^2}{2}\Big)\delta t + \sigma\varepsilon\sqrt{\delta t}}
  (\#eq:logprice)
\end{equation} 

Nesta equa√ß√£o o $\mu$ representa a taxa de retorno anual esperado, sendo que $\sigma$ representa o desvio padr√£o ou volatilidade da ac√ß√£o, par√¢metro muito importante para a determina√ß√£o do valor de v√°rios derivados, havendo v√°rias formas de calcular este valor como veremos mais adiante. Estes valores s√£o fun√ß√£o do corrente valor de S e do tempo actual t. Numa economia neutra face ao risco $\mu$ √© igual a taxa de juro sem risco. O $\varepsilon$ representa uma vari√°vel com distribui√ß√£o normal(N(0,1)). 

Este processo √© conhecido como movimento Browniano geom√©trico (GBM). De acordo com @AppliedFinancial um "GBM pode ser considerado como um movimento probabil√≠stico cont√≠nuo no qual o logaritmo da quantidade que varia aleatoriamente segue um movimento Browniano (processo de Wiener) com desvio." Este modelo √© a base do modelo de Black-Scholes, que ser√° revisto mais adiante, aquando do c√°lculo da volatilidade impl√≠cita nas op√ß√µes.

Tendo em considera√ß√£o a equa√ß√£o \@ref(eq:logprice), S segue uma distribui√ß√£o lognormal. Uma distribui√ß√£o lognormal √© mais real√≠stico de acordo com o movimento do pre√ßo das ac√ß√µes, prevenindo que o valor se torne negativo.

Em simula√ß√£o, este processo √© realizado considerando uma distribui√ß√£o normal com m√©dia e vari√¢ncia dada pela equa√ß√£o \@ref(eq:Inito) [@FRM1].

### Simula√ß√£o de Monte Carlo

A simula√ß√£o de Monte Carlo consiste na gera√ß√£o de valores a partir de uma determinada distribui√ß√£o ou amostra, sendo que "o termo Monte Carlo √© usado para se referir a t√©cnicas que envolvem simula√ß√£o computacional"[@ProgSim,pp.457]. 

Ao simular os pre√ßos dos activos financeiros iremos utilizar a t√©cnica de Monte Carlo de modo a gerar amostras aleat√≥rias de acordo com a equa√ß√£o \@ref(eq:logprice). Os pre√ßos ser√£o simulados criando v√°rias tentativas com valores aleat√≥rios para $\varepsilon$ a partir de $\phi$(0,1). A precis√£o dos valores obtidos na simula√ß√£o depende do n√∫mero de tentativas efectuadas, sendo considerado 1000 tentativas por cada dia e considerar o valor m√©dio dessas tentativas como o valor simulado para cada um dos dias simulados.

## Volatilidade

Na ind√∫stria financeira o desvio padr√£o associado a instrumentos financeiros √© definido como volatilidade. Desta forma quando estamos a falar de volatilidade estamos a considerar o desvio padr√£o observado.

De acordo com @HullRisk2018:
\begin{spacing}{1}
\begin{adjustwidth}{28.3464pt}{28.3464pt}\footnotesize
"A vari√°vel volatilidade, $\sigma$, √© definida como o desvio padr√£o do retorno fornecido pela vari√°vel por unidade de tempo quando o retorno √© expresso usando juros compostos. Quando a volatilidade √© usada para valorizar op√ß√µes, a unidade de tempo √© normalmente 1 ano, sendo a volatilidade o desvio padr√£o do retorno compostos por ano. Quando a volatilidade √© usada para a gest√£o de risco, a unidade de tempo usual √© 1 dia de forma a que a volatilidade √© o desvio padr√£o do retorno composto por dia." (pp.213-214)
\normalsize\end{adjustwidth}
\end{spacing}

V√°rios s√£o os modelos para calculo da volatilidade, sendo que um dos modelos mais simples √© o do c√°lculo da vari√¢ncia de acordo com a equa√ß√£o \@ref(eq:estdesviopadrao) utilizando os dados hist√≥ricos dos retornos, sendo que neste modelo o peso atribu√≠do aos dados √© o mesmo independentemente da sua antiguidade. Outros modelos como a M√©dia M√≥vel Exponencial Ponderada (EWMA) e Heteroscedasticidade condicional auto-regressiva generalizada (GARCH) s√£o modelos, que embora utilizem dados hist√≥ricos, reconhecem que tanto a volatilidade como a correla√ß√£o n√£o s√£o constantes ao longo do tempo, atribuindo maior peso aos dados mais recentes. Por fim, um dos modelos que n√£o integra dados hist√≥ricos mas sim as expectativas futuras para o c√°lculo da volatilidade √© o da volatilidade impl√≠cita, utilizando o modelo de Black-Scholes-Merton na valoriza√ß√£o das respectivas op√ß√µes relativamente ao subjacente.

### M√©dia M√≥vel Exponencial Ponderada (EWMA)

O modelo da m√©dia m√≥vel exponencial ponderada (EWMA) √© um estimador calculado a partir de amostras sequenciais da popula√ß√£o onde √© atribuindo maior peso aos valores mais recentes, sendo que esse peso diminui exponencialmente a medida que vamos recuando no tempo. A formula utilizada para actualizar o valor para a volatilidade √©

\begin{equation} 
  \sigma_{n}^{2} = \lambda\sigma_{n-1}^{2}+(1-\lambda)\mu_{n-1}^{2} 
  (\#eq:ewma)
\end{equation} 

onde 0<$\lambda\leq1$ √© uma constante, sendo $\sigma_{n-1}$ a estimativa da volatilidade realizada no dia n-2 para o dia n-1, e $\mu_{n-1}$ a mudan√ßa percentual di√°ria mais recente. Ao valor de $\lambda$ atribuido "estudos emp√≠ricos mostram que o *decay factor* ($\lambda$) 0,94 fornece uma boa estimativa para todos os ativos."[@riskmetrics,p.4]

De modo a entender porque √† volatilidade obtida atrav√©s da EWMA correspondem pesos que diminuem exponencialmente vamos substituir $\sigma_{n-1}^{2}$ na equa√ß√£o \@ref(eq:ewma) de modo a obter

\begin{equation} 
  \sigma_{n}^{2} = (1-\lambda)(\mu_{n-1}^{2}+\lambda\mu_{n-2}^{2})+\lambda^{2}\sigma_{n-2}^{2}
  (\#eq:ewma1)
\end{equation} 

Continuando a substituir acabamos por obter

\begin{equation} 
  \sigma_{n}^{2} = (1-\lambda)\sum_{i=1}^{m}\lambda^{i-1}\mu_{n-1}^{2}+\lambda^{m}\mu_{n-m}^{2}
  (\#eq:ewma2)
\end{equation} 

Como podemos ver pela equa√ß√£o \@(eq:ewma2) o "peso de $\mu_{i}$ decresce a uma taxa $\lambda$ a medida que vamos recuando no tempo. Cada peso √© $\lambda$ vezes o peso anterior." [@HullRisk2018,p.226]. Como os pesos diminuem geometricamente, o EWMA tamb√©m √© referido como m√©dia m√≥vel geom√©trica. 

### Heteroscedasticidade condicional auto-regressiva generalizada (GARCH)

Quando a vari√¢ncia e a covari√¢ncia variam ao longo do tempo falamos de heteroscedasticidade condicional.

O facto da vari√¢ncia condicional puder mudar de forma heteroscedastica, n√£o implica necessariamente que a serie √© n√£o estacion√°ria ou divergente.

Em finan√ßas uma das classes de modelos mais utilizada para prever a volatilidade s√£o os modelos *AutoRegressive Conditional Heteroscedasticity* (ARCH)^[Introduzido por Robert F.Engle em 1982, tendo-lhe sido atribu√≠do o pr√©mio Nobel da economia em 2003] e *Generalized* (GARCH)^[Introduzido por Bollerslev(1986)].
Auto-regressivo significa que a vari√¢ncia presente depende do seu pr√≥prio passado e n√£o num regressor ex√≥geno. O facto de ser condicional significa que a vari√¢ncia de amanh√£ depende das vari√¢ncias mais recentes. J√° a heteroscedasticidade significa que a vari√¢ncia n√£o √© constante ao longo do tempo. O pressuposto destes modelos √© de que a vari√¢ncia dos retornos seguem um processo previs√≠vel, sendo que os modelos ARCH s√£o menos convincentes na previs√£o quando a volatilidade t√™m altera√ß√µes bruscas.

Um modelo mais flex√≠vel que o modelo ARCH foi proposto, sendo este o modelo GARCH

### Volatilidade impl√≠cita

O modelo de Black-Scholes-Merton^[Os autores, Robert Merton e Myron Scholes, foram reconhecidos com o Nobel da economia em 1997] foi um modelo desenvolvido nos anos 70, considerado um ponto de ruptura na defini√ß√£o do pre√ßo de op√ß√µes sobre ac√ß√µes europeias. 

De entre os pressupostos^[Para mais informa√ß√£o ver @BlackScholes,pp. 640, capitulo "The valuation formula"] utilizados para derivar a equa√ß√£o diferencial, importa salientar de que a taxa de juro sem risco, r, √© constante e a mesma ao longo do tempo. De acordo com @Hull2018 "√â importante considerar que a avalia√ß√£o sem risco (ou o pressuposto de que todos os investidores s√£o neutros ao risco) √© meramente um artif√≠cio para obter solu√ß√£o para a equa√ß√£o diferencial de Black-Scholes-Merton"(p.312).

O processo que se assume ser aplicado ao pre√ßo dos activos √© o descrito pela equa√ß√£o \@ref(eq:ito). De salientar de que nenhumas das vari√°veis da equa√ß√£o √© afectada pelas prefer√™ncias de risco dos investidores, sendo que as vari√°veis que aparecem na equa√ß√£o s√£o o valor presente do activo financeiro, tempo, volatilidade e a taxa de juro sem risco. 

As solu√ß√µes obtidas a partir da equa√ß√£o diferenci√°vel de interesse para calculo da volatilidade impl√≠cita, s√£o as aqui apresentadas para valorizar op√ß√µes de compra (*call*) e op√ß√µes de venda (*put*) do tipo europeias:

\begin{equation} 
  c = S_0N(d_1) - Ke^{-rT}N(d_2);
  (\#eq:call)
\end{equation} 
e
\begin{equation} 
  p = Ke^{-rT}N(-d_2) - S_0N(-d_1);
  (\#eq:put)
\end{equation} 
onde
\begin{equation} 
  d_1 = \frac{In(S_0/K)+(r+\sigma^2/2)T}{\sigma\sqrt{T}}
  (\#eq:d1)
\end{equation}
\begin{equation} 
  d_2 = \frac{In(S_0/K)+(r-\sigma^2/2)T}{\sigma\sqrt{T}}=d_1-\sigma\sqrt{T}
  (\#eq:d2)
\end{equation}

A fun√ß√£o N(x) representa a fun√ß√£o distribui√ß√£o para uma distribui√ß√£o normal padr√£o, sendo a probabilidade de uma vari√°vel ser menor que x (ver exemplo na figura \@ref(fig:fdistribuicao)). O valor de N(x) pode ser obtido com a fun√ß√£o do R pnorm(). A vari√°vel T representa o tempo medido em dias de negocia√ß√£o que faltam at√© a expira√ß√£o da op√ß√£o dividido pelos dias de negocia√ß√£o nesse ano, sendo S~0~ o valor do activo subjacente no tempo 0, r a taxa de juro sem risco, $\sigma$ a volatilidade anual e K o pre√ßo de exerc√≠cio da op√ß√£o.
```{r, fdistribuicao,echo=FALSE,fig.cap='Fun√ß√£o distribui√ß√£o N(x)',out.width="45%"}
knitr::include_graphics("image/fdistribuicao.png")
```
\centering 
Fonte: Elabora√ß√£o pr√≥pria.

\justifying
\bigskip

O par√¢metro da volatilidade n√£o √© um par√¢metro que se consiga obter ou observar directamente, sendo um valor que representa a volatilidade esperada pelos investidores no futuro, conhecido como **volatilidade impl√≠cita**. Um modo de obter este valor √© a partir dos restantes par√¢metros, ou seja, tendo o valor de uma op√ß√£o de compra, e considerando os valores de S~0~, K, r e T, substituir estes pelos respectivos valores e obter o valor de $\sigma$ que iguale o valor da *call* utilizando as equa√ß√µes \@ref(eq:call) e \@ref(eq:d1) atrav√©s de processos por aproxima√ß√£o iterativo. 

A volatilidade impl√≠cita ser√° diferente consoante o pre√ßo de exerc√≠cio da op√ß√£o, considerando todos os outros par√¢metros iguais. Da conjuga√ß√£o dos valore de volatilidade obtidos para cada um dos pre√ßos de exerc√≠cio da op√ß√£o obt√™m-se um gr√°fico conhecido como *volatility smile*(figura \@ref(fig:volatilitysmile)). Este gr√°fico ser√° o mesmo, quer se esteja a considerar uma op√ß√£o do tipo *call* ou a mesma equivalente op√ß√£o do tipo *put*.

A vari√°vel volatilidade, ùúé, √© definida como o desvio padr√£o do retorno fornecido pela
vari√°vel por unidade de tempo quando o retorno √© expresso usando juros compostos.
Quando a volatilidade √© usada para valorizar op√ß√µes, a unidade de tempo √© normalmente 1 ano, sendo a volatilidade o desvio padr√£o do retorno compostos por ano.
Quando a volatilidade √© usada para a gest√£o de risco, a unidade de tempo usual √© 1 dia
de forma a que a volatilidade √© o desvio padr√£o do retorno composto por dia.‚Äù(pp.213-
214)
```{r, volatilitysmile,echo=FALSE,fig.cap='Volatility Smile',out.width = "60%"}
knitr::include_graphics("image/volatilitysmile.png")
```
\centering 
Fonte: [@volatilitysmile, pp.182]

\justifying
\bigskip

Como de pode ver pela figura \@ref(fig:volatilitysmile) a op√ß√£o √© considerada *out-the-money* se o seu valor for inferior ao do respectivo subjacente, *at-the-money* se for superior e *in-the-money* se o valor for igual. No calculo do valor da volatilidade ser√° utilizado o valor de pre√ßo de exerc√≠cio *in-the-money* de op√ß√µes do tipo *call*, ou na impossibilidade do valor do subjacente ser o mesmo do K, o mais pr√≥ximo deste.

Quando comparado com outros m√©todos para calcular a volatilidade onde os dados utilizados s√£o dados hist√≥ricos, este m√©todo incorpora o sentimento presente dos investidores relativo a volatilidade futura de um determinado ativo ou instrumento financeiro.

## Portfolios m√©dia-vari√¢ncia

A otimiza√ß√£o de portfolios atrav√©s da diversifica√ß√£o √© um conceito b√°sico que teve origem em Markowitz, criando o conceito de fronteira eficiente. Existem v√°rios pressupostos definidos na obten√ß√£o deste modelo, n√£o sendo, no entanto, o √¢mbito aqui analisar esses mesmos pressupostos, considerando que independentemente disso esses mesmos pressupostos s√£o verificados. De acordo com @Modern2013, ‚Äútodas os pressupostos acerca da analise de portfolio foram demonstradas serem simplistas, e em alguns casos demasiado simplistas.[...]Pessoas necessitam apenas de se comportar como se fossem descritas pelos pressupostos para uma teoria ser v√°lida‚Äù [@Modern2013,pp.5]. 

Para aplica√ß√£o deste modelo deve-se obter os seguintes dados dos instrumentos financeiros que v√£o constituir o portfolio:

- A taxa do retorno esperado, E(r);
- O desvio padr√£o dos retornos, $\sigma$;
- O coeficiente de correla√ß√£o,$\rho$, entre cada um dos activos.

O retorno esperado vai depender de v√°rios factores, essencialmente a taxa de retorno sem risco que se verifica no mercado, a taxa de infla√ß√£o e o risco a que o investidor estar√° sujeito, sendo que quanto maior o risco, maior ser√° o retorno esperado.
As s√©ries dos retornos di√°rios para cada um dos activos √© calculada de acordo com a seguinte formula:

\begin{equation} 
  R_i = ln\Big(\frac{S_f}{S_i}\Big)
  (\#eq:logRet)
\end{equation} 

A m√©dia dos retornos de cada um dos activos √© calculada de acordo com a sua m√©dia aritm√©tica:

\begin{equation} 
  \overline{R} = \frac{\displaystyle\sum_{i=1}^n R_i}{n}
  (\#eq:meanRet)
\end{equation}  

O desvio padr√£o representa a volatilidade, ou risco, associada ao activo. Considerando que essa volatilidade √© calculada com base nos dados hist√≥ricos e as formulas acima, ent√£o a estat√≠stica da amostra para o desvio padr√£o representa-se pela seguinte formulas:

\begin{equation} 
  \hat{\sigma} = \sqrt\frac{\displaystyle\sum_{i=1}^n (R_i-\overline{R})^2}{n-1}
  (\#eq:estdesviopadrao)
\end{equation} 

A escolha do tamanho da amostra (n) deve ser grande o suficiente de modo a garantir uma melhor precis√£o nas estat√≠sticas obtidas, sendo que neste caso devemos considerar que a volatilidade n√£o √© constante ao longo do tempo e que valores mais antigos podem n√£o ser t√£o relevantes como os valores mais recentes. De acordo com [@Hull2018] esse valor deve ser compreendido entre 90 a 180 dias para a cota√ß√£o de activos. 

Para o calculo da volatilidade anual utiliza-se os n√∫mero de dias de negocia√ß√£o, sendo considerado 252 dias por ano como valor de refer√™ncia.

## Value at Risk

A quantifica√ß√£o do risco √© fundamental para a gest√£o e atenua√ß√£o de perdas no valor da carteira ao longo do tempo. Na gest√£o da carteira a aplica√ß√£o de m√©tricas de risco permite a adapta√ß√£o cont√≠nua do portf√≥lio aos fatores de risco quantific√°veis, podendo-se, atrav√©s de uma gest√£o ativa, manter o investidor devidamente informado relativamente ao risco que o seu investimento incorpora e poder tomar medidas proactivas de adapta√ß√£o do investimento ao n√≠vel de risco verificado, tendo em considera√ß√£o o perfil do investidor.O Value at Risk (VaR) √© uma dessas m√©tricas de risco.

O Value at Risk (VaR)^[Markowitz foi dos primeiros autores a contemplar a an√°lise de risco em investimentos, como se pode verificar em @Markowitz1952] √© uma medida probabil√≠stica para a perda m√°xima prov√°vel de uma carteira para um n√≠vel de confian√ßa determinado,num horizonte temporal especificado. Pode-se definir o VaR como "descrevendo o quantil da distribui√ß√£o de ganhos e perdas projectado ao longo do horizonte alvo. Se *c* for o intervalo de confian√ßa selecionado, VaR corresponde ao n√≠vel inferior da cauda 1-*c* "[@philippe,pp.17]. Este valor √© sempre positivo.

O calculo do valor do VaR √© de car√°cter obrigat√≥rio para entidades financeiras e seguradoras, sendo que os reguladores, dependendo da sua jurisdi√ß√£o, determinam os par√¢metros quantitativos a serem utilizados.
No caso do Banco Central Europeu^[ver relat√≥rio t√©cnico @ecb], esses par√¢metros s√£o de que o c√°lculo deve ser efectuado para um intervalo temporal de 10 dias de negocia√ß√£o e para um intervalo de confian√ßa de 99%, sendo considerado para esses c√°lculos pelo menos 250 dias negocia√ß√£o de observa√ß√£o de valores hist√≥ricos.

O c√°lculo do VaR pode ser realizado de modos diferentes, existindo v√°rios m√©todos, sendo considerados m√©todos de tipo n√£o param√©trico, como o m√©todo hist√≥rico em que n√£o se assume nenhum pressuposto na distribui√ß√£o desses dados, ou m√©todos do tipo param√©trico, onde se assume um determinado tipo de distribui√ß√£o dos dados. Para efeito desta disserta√ß√£o ser√° aplicado um m√©todo param√©trico para c√°lculo do VaR.

### VaR Param√©trico (Gaussiana)

O VaR param√©trico pressup√µe que os retornos di√°rios apresentem uma distribui√ß√£o normal (figura \@ref(fig:var)), sendo que a sua representa√ß√£o matem√°tica se encontra definida na equa√ß√£o \@ref(eq:var).
\begin{equation} 
  VaR_{t+1}^{p} = -\sigma_{t+1}\Phi_{p}^{-1}
  (\#eq:var)
\end{equation} 
(ref:var) VaR com intervalo confian√ßa 95% e 99%. 
```{r, var, echo=FALSE, fig.cap="(ref:var)", out.width="60%"}
knitr::include_graphics("image/VaR.png")
```
\FloatBarrier
\centering 
Fonte: [@phdthesis, pp.13]

\justifying
\bigskip
O $\Phi (p)$ representa a fun√ß√£o distribui√ß√£o e $\Phi^{-1} (p)$ a sua inversa, sendo que, por exemplo, para um intervalo de confian√ßa de 99% o valor de $\Phi^{-1} (p)$ corresponde a -2.33. Se considerarmos que a volatilidade prevista a 1 dia √© de 2%, teremos um VaR = -0.020*(-2.33), o que corresponde a um valor de 0.0466. Podemos interpretar o VaR como sendo a exist√™ncia de 1% de probabilidade de perder mais do que 4.66% do valor investido no activo no dia de hoje. 

O *Daily Value at Risk* (DEaR) √© o valor diariamente em risco, sendo calculado de acordo com a equa√ß√£o \@ref(eq:dear).
\begin{equation} 
  ‚Ç¨DEaR = ‚Ç¨ \textnormal{Valor de mercado do investimento} * VaR
  (\#eq:dear)  
\end{equation} 

O valor do VaR a mais de um dia pode-se calcular a partir do DEaR a um dia, de acordo com a equa√ß√£o \@ref(eq:vardays), onde N representa o n√∫mero de dias.
\begin{equation} 
  VaR = DEaR*\sqrt{N}
  (\#eq:vardays)
\end{equation} 

Se estivermos a analisar o VaR de um portfolio, esse √© calculado da mesma forma que a vari√¢ncia de um portfolio (equa√ß√£o \@ref(eq:varport)), considerando o DEaR individual de cada componente.
\begin{equation} 
  DEaR_{portfolio}^{2} = \sum_{i=1}^{N}\sum_{j=1}^{N}Cov(DEaR_i,DEaR_j)
  (\#eq:varport)
\end{equation} 
onde
\begin{equation} 
  Cov(DEaR_i,DEaR_j) = DEaR_{i}DEaR_{j}\rho(DEaR_i,DEaR_j)
  (\#eq:covport)
\end{equation}

Por exemplo, considerando 2 activos, A e B, constituintes de um portfolio, ter√≠amos:
\begin{equation} 
  DEaR_{A+B}^{2} = DEar_{A}^{2}+DEaR_{B}^{2}+2\rho_{AB} DEaR_{A} DEaR_B
  (\#eq:ab)
\end{equation}

### VaR Param√©trico (Aproxima√ß√£o Cornish-Fisher)

Quando a distribui√ß√£o dos retornos apresentam excesso de curtose^[medida de dispers√£o que caracteriza o achatamento da curva da fun√ß√£o de distribui√ß√£o] (*Kurtosis*) e/ou assimetria^[permite distinguir as distribui√ß√µes assim√©tricas] (*Skewness*) relativamente a uma distribui√ß√£o normal pode-se proceder √† aproxima√ß√£o Cornish-Fisher, permitindo desta forma uma aproxima√ß√£o ao VaR. Por exemplo, na figura \@ref(fig:quant) temos uma distribui√ß√£o do tipo leptoc√∫rtica, sendo caracterizada por um pico mais alto e caudas mais pesadas que uma distribui√ß√£o normal.
\bigskip
```{r, quant,echo=FALSE,fig.cap='Kurtosis',out.width = "60%"}
knitr::include_graphics("image/kurtosis.png")
```
\centering 
Fonte: [@quant, pp.46]

\justifying
O c√°lculo do VaR com aproxima√ß√£o Cornish-Fisher efectua-se de acordo com a equa√ß√£o \@ref(eq:varcf), sendo que para calcular o valor referente a CF se aplica a equa√ß√£o \@ref(eq:cf).
\begin{equation} 
  VaR_{t+1}^{p} = -\sigma_{t+1}*CF_{p}^{-1}
  (\#eq:varcf)
\end{equation} 
onde
\begin{equation} 
  CF_{p}^{-1} = \Phi_{p}^{-1} + \frac{\zeta_{1}}{6}[(\Phi_{p}^{-1})^2-1] + \frac{\zeta_{2}}{24}[(\Phi_{p}^{-1})^3-3\Phi_{p}^{-1}] - \frac{\zeta_{1}^{2}}{36}[2(\Phi_{p}^{-1})^3-5\Phi_{p}^{-1}]
  (\#eq:cf)
\end{equation}

Os par√¢metros referentes a $\zeta_1$ e $\zeta_2$ s√£o respectivamente os valores da assimetria e do excesso de curtose. Esses valores s√£o obtidos de acordo com as equa√ß√µes \@ref(eq:assimetria) e \@ref(eq:curtose).
\begin{equation} 
 \zeta_1 = \frac{1}{n}\sum\bigg[\frac{X_i - \overline{X}}{\sigma}\bigg]^3
  (\#eq:assimetria)
\end{equation} 
\begin{equation} 
 \zeta_2 = \frac{1}{n}\sum\bigg[\frac{X_i - \overline{X}}{\sigma}\bigg]^4 - 3
  (\#eq:curtose)
\end{equation} 
